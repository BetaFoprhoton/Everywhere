<ResourceDictionary
  xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:at="clr-namespace:Everywhere.AttachedProperties" xmlns:configuration="clr-namespace:Everywhere.Configuration"
  xmlns:v="using:Everywhere.Views">
  <Design.PreviewWith>
    <v:SettingsItemsControl/>
  </Design.PreviewWith>

  <ControlTheme
    x:Key="{x:Type v:SettingsItemsControl}"
    TargetType="v:SettingsItemsControl">

    <Setter Property="CornerRadius" Value="{DynamicResource XlCornerRadius}"/>

    <Setter Property="Template">
      <ControlTemplate>
        <ItemsPresenter
          x:Name="PART_ItemsPresenter"
          ItemsPanel="{TemplateBinding ItemsPanel}"/>
      </ControlTemplate>
    </Setter>

    <Setter Property="ItemsPanel">
      <ItemsPanelTemplate>
        <StackPanel Spacing="8"/>
      </ItemsPanelTemplate>
    </Setter>

    <Setter Property="ItemTemplate">
      <DataTemplate DataType="configuration:SettingsItem">
        <Expander
          Background="Transparent"
          BorderBrush="{Binding $parent[v:SettingsItemsControl].BorderBrush}"
          BorderThickness="{Binding $parent[v:SettingsItemsControl].BorderThickness}"
          Classes.NotExpandable="{Binding !IsExpandable}"
          CornerRadius="{Binding $parent[v:SettingsItemsControl].CornerRadius}"
          IsEnabled="{Binding IsEnabled}"
          IsExpanded="{Binding IsExpanded, Mode=TwoWay}"
          IsVisible="{Binding IsVisible}">
          <Expander.Styles>
            <Style Selector="ContentControl#PART_SettingsItemContentControl">
              <Setter Property="at:DataTemplatesAttach.DataTemplates">
                <DataTemplates>
                  <DataTemplate DataType="configuration:SettingsBooleanItem">
                    <ToggleSwitch
                      Margin="0,0,4,0"
                      IsChecked="{Binding Value, Mode=TwoWay}"
                      IsThreeState="{Binding IsNullable}"/>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsStringItem">
                    <TextBox
                      MinWidth="320" MinHeight="32"
                      HorizontalAlignment="Left"
                      AcceptsReturn="{Binding IsMultiline}"
                      MaxLength="{Binding MaxLength}"
                      PasswordChar="{Binding PasswordChar}"
                      Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Watermark="{Binding Watermark}"/>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsIntegerItem">
                    <StackPanel
                      HorizontalAlignment="Left" Orientation="Horizontal"
                      Spacing="8">
                      <Slider
                        Width="320" IsSnapToTickEnabled="True"
                        IsVisible="{Binding IsSliderVisible}"
                        Maximum="{Binding MaxValue}"
                        Minimum="{Binding MinValue}"
                        Value="{Binding Value, Mode=TwoWay}"/>
                      <TextBox
                        MinHeight="32" VerticalAlignment="Center"
                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsDoubleItem">
                    <StackPanel
                      HorizontalAlignment="Left" Orientation="Horizontal"
                      Spacing="8">
                      <Slider
                        Width="320" IsSnapToTickEnabled="True"
                        IsVisible="{Binding IsSliderVisible}"
                        Maximum="{Binding MaxValue}"
                        Minimum="{Binding MinValue}"
                        TickFrequency="{Binding Step}"
                        Value="{Binding Value, Mode=TwoWay}"/>
                      <TextBox
                        MinHeight="32" VerticalAlignment="Center"
                        Text="{Binding Value, Mode=TwoWay, StringFormat={}{0:F1}, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsCustomizableItem">
                    <StackPanel Orientation="Horizontal">
                      <ContentControl
                        x:Name="PART_SettingsItemContentControl" HorizontalAlignment="Left"
                        HorizontalContentAlignment="Left"
                        Content="{Binding CustomValueItem}"/>

                      <Button
                        Classes="Ghost" Width="36"
                        Margin="8,0,0,0" Padding="0"
                        Command="{Binding ResetCommand}"
                        ToolTip.Tip="{I18N {x:Static LocaleKey.SettingsPage_RestoreDefault_Button_ToolTip}}">
                        <LucideIcon
                          Width="18" Height="18"
                          Kind="RotateCcw" Size="18"/>
                      </Button>
                    </StackPanel>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsSelectionItem">
                    <ComboBox
                      MinWidth="320" MinHeight="32"
                      HorizontalAlignment="Left"
                      ItemsSource="{Binding ItemsSource}"
                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
                      <ComboBox.ItemTemplate>
                        <DataTemplate DataType="configuration:SettingsSelectionItem+Item">
                          <ContentControl
                            Content="{Binding Key^}"
                            ContentTemplate="{Binding ContentTemplate}"/>
                        </DataTemplate>
                      </ComboBox.ItemTemplate>
                    </ComboBox>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsKeyboardHotkeyItem">
                    <v:KeyboardHotkeyInputBox
                      MinWidth="160" MinHeight="32"
                      HorizontalAlignment="Left"
                      Hotkey="{Binding Value, Mode=TwoWay}"/>
                  </DataTemplate>

                  <DataTemplate DataType="configuration:SettingsControlItem">
                    <ContentControl Content="{Binding Control}"/>
                  </DataTemplate>
                </DataTemplates>
              </Setter>
            </Style>
          </Expander.Styles>

          <Expander.Header>
            <StackPanel>
              <TextBlock
                Classes="p" Margin="0,-8,0,0"
                IsHitTestVisible="False"
                Text="{Binding HeaderKey^}"
                TextWrapping="Wrap"/>
              <TextBlock
                Classes="Muted" IsHitTestVisible="False"
                Text="{Binding DescriptionKey^}"
                TextWrapping="Wrap"/>
              <ContentControl
                x:Name="PART_SettingsItemContentControl" Margin="0,8,0,0"
                Content="{Binding}"/>
            </StackPanel>
          </Expander.Header>

          <v:SettingsItemsControl
            HorizontalAlignment="Stretch"
            ItemsSource="{Binding Items}"/>
        </Expander>
      </DataTemplate>
    </Setter>
  </ControlTheme>
</ResourceDictionary>
